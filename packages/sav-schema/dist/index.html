<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Document</title>
</head>
<body>
  <script type="text/javascript" src="https://unpkg.com/json5"></script>
  <script type="text/javascript" src="sav-schema-umd.js"></script>
  <script type="text/javascript">
  {
    let lists = [
      {
        typeName: 'Integer',
        createCases: [1, 1.2, 2],
        checkCases: [1, 2],
      },
      {
        typeName: 'String',
        createCases: [1, '1.2', 2],
        checkCases: [1, '1.2', 2],
      }
    ]
    lists.forEach(({typeName, createCases, checkCases}) => {
      console.group(typeName)
      let Item = schema[typeName]
      console.log('create -', JSON.stringify(Item.create()))
      createCases.forEach((val, id) => {
        console.log('create', id, JSON.stringify(Item.create(val)))
      })
      checkCases.forEach((val, id) => {
        console.log('check ', id, JSON.stringify(Item.check(val)))
      })
      console.groupEnd(typeName)
    })
  }
  {
    let lists = [
      {
        caseName: 'Enum-Sex',
        declares: {
          name: 'Sex',
          enums: [
            {key: 'male', value: 1},
            {key: 'female', value: 2}
          ],
          default: 1
        },
        createCases: [3],
        checkCases: [3, 1, 2]
      },
      {
        caseName: 'Struct-Type-Enum',
        declares: {
          props: {
            name: String,
            id: {
              type: Number,
              optional: true
            },
            sex: {
              type: 'Sex',
              required: false
            }
          }
        },
        createCases: [{id: '10'}, {id: '10', name: 1}],
        checkCases: [{name: 'jetiny', id: '10'}]
      },
      {
        caseName: 'Struct-Array',
        declares: {
          props: {
            ids: {
              array: Number
            }
          }
        },
        createCases: [{ids: [1, '2']}],
        checkCases: [{ids: [1, '2']}],
      },
      {
        caseName: 'Struct-Array-Enum',
        declares: {
          props: {
            ids: {
              array: 'Sex'
            }
          }
        },
        createCases: [{ids: [1, '2']}],
        checkCases: [{ids: [1, '2']}]
      },
      {
        caseName: 'Struct-Array-Struct',
        declares: {
          props: {
            ids: {
              array: {
                props: {
                  id: Number
                }
              }
            }
          }
        },
        createCases: [{ids: [{id: 1}, {id: '2'}]}],
        checkCases: [{ids: [{id: 1}, {id: '2'}]}]
      },
      {
        caseName: 'Array-Basic',
        declares: {
          array: Number
        },
        createCases: [[1], ['10']],
        checkCases: [[1, '10']]
      },
      {
        caseName: 'Array-Struct',
        declares: {
          array: {
            props: {
              id: Number
            }
          }
        },
        createCases: [[{id: 1}], [{id: '10'}]],
        checkCases: [[{id: 1}, {id: '10'}]]
      },
      {
        caseName: 'Array-Struct-Ref',
        declares: {
          array: 'User',
          refs: {
            User: {
              props: {
                id: Number
              }
            }
          }
        },
        createCases: [[{id: 1}], [{id: '10'}]],
        checkCases: [[{id: 1}, {id: '10'}]]
      },
      {
        caseName: 'Array-Array-Struct',
        declares: {
          array: {
            array: {
              props: {
                id: Number
              }
            }
          }
        },
        createCases: [[[{id: 1}]], [[{id: '10'}]]],
        checkCases: [[[{id: 1}], [{id: '10'}]]]
      },
      {
        caseName: 'Array-Array-Type',
        declares: {
          array: {
            array: Number
          }
        },
        createCases: [[[1]], [['10']]],
        checkCases: [[[1], ['10']]]
      },
      {
        caseName: 'Array-Array-Enum',
        declares: {
          array: {
            array: 'Sex'
          }
        },
        createCases: [[[1]], [['2']]],
        checkCases: [[[1], ['2']]]
      },
    ]
    lists.forEach(({caseName, declares, createCases, checkCases}) => {
      console.group(caseName)
      let Item = schema.declare(declares)
      console.log('declare', JSON.stringify(Item.opts))
      console.log('create -', JSON.stringify(Item.create()))
      createCases.forEach((val, id) => {
        console.log('create', id, JSON.stringify(Item.create(val)))
      })
      checkCases.forEach((val, id) => {
        console.log('check ', id, JSON.stringify(Item.check(val)))
      })
      console.groupEnd(caseName)
    })
  }
  </script>
  <script type="text/javascript">
    let UserInfo = schema.declare({
      props: {
        age: {
          type: Number,
          checkes: [
            ['re', /\w+/]
          ]
        }
      }
    })
    UserInfo.check({age: 300})
  </script>
  <script type="text/javascript">
    let SchemaType = schema.Array.constructor
    let Age = new SchemaType({
      export (obj) {
        console.log(obj.name)
      }
    }, {
      name: Number,
      default: 1,
      check: function (val) {
        return typeof val === 'number'
      },
      parse: Number
    })
    Age.create()
  </script>
  <style type="text/css">
    #inputEditor,
    #outputEditor {
      width: 40%;
      height: 100%;
    }
    #inputText,
    #outputText {
      resize: vertical;
      width: 100%;
      height: 100%;
    }
    #editor {
      display: flex;
      justify-content: space-around;
      flex: 1;
      padding-bottom: 20px;
    }
    #title {
      text-align: center;
      margin: 20px;
    }
    #main {
      position: fixed;
      display: flex;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      flex-direction: column;
    }
  </style>
  <div id="main">
    <div id="title">JSON-Schema生成器</div>
    <div id="editor">
      <div id="inputEditor">
        <textarea id="inputText" placeholder="这里输入JSON"></textarea>
      </div>
      <div id="outputEditor">
        <textarea id="outputText" placeholder="这里生成Schema"></textarea>
      </div>
    </div>
  </div>
  <script type="text/javascript">
    inputText.onchange = function () {
      try {
        let jsonValue = JSON5.parse(this.value)
        outputText.value = JSON.stringify(schema.toSchema(jsonValue), null, 2)
      } catch (err) {
        outputText.value = err.message
      }
    }
  </script>
  <script type="text/javascript">
    let s = new schema.Schema()
    {
      let User = s.declare({
        props: {
          uid: Number
        }
      })
      console.log(User.createRequest())
      console.log(User.createRequest({uid: 10, s: 1}))
    }
    {
      let User = s.declare({
        array: Number
      })
      console.log(User.createRequest([]))
      console.log(User.createRequest([1, 2]))
    }
  </script>
</body>
</html>
